# Ralph Progress Log
Started: 2026-01-28

## Codebase Patterns
- Game engine modules go in src/engine/ (Room.js, Item.js, Parser.js, etc.)
- Room/item data files go in src/data/
- UI modules go in src/ui/
- Pixel art images go in public/images/
- This is a vanilla JavaScript browser game - no build step required
- Use ES6 modules with import/export
- Game runs by opening index.html in a browser
- Start local server with: `cd public && python3 -m http.server 8080`

---

## 2026-01-28 - US-001
- **What was implemented:** Project setup and directory structure
- **Files changed:**
  - public/index.html - Game UI with intro screen, image panel, text output, command input
  - public/styles.css - Retro VGA-style aesthetics with pixel fonts, CRT effect
  - public/game.js - Main entry point with basic command handling (LOOK, INVENTORY, HELP)
  - prd.json - Project definition with 51 user stories
- **Learnings for future iterations:**
  - HTML uses type="module" for ES6 module support
  - The intro screen overlay hides with classList.add('hidden')
  - output() function appends p elements to #game-output
  - handleCommand() will be refactored to use Parser class in US-005
  - Placeholder room description hardcoded - will be replaced by Room class in US-002
---

## 2026-01-28 - US-002
- **What was implemented:** Room class for game locations
- **Files changed:** src/engine/Room.js
- **Learnings:** Connections can be string (roomId) or object with locked/requiredKey properties
---

## 2026-01-28 - US-003
- **What was implemented:** Item class for interactive objects
- **Files changed:** src/engine/Item.js
- **Learnings:** Items support custom handlers via setUseHandler(), aliases for matching player input
---

## 2026-01-28 - US-004
- **What was implemented:** Inventory system for player items
- **Files changed:** src/engine/Inventory.js
- **Learnings:** findByName() searches both name and aliases, getDisplayString() for UI
---

## 2026-01-28 - US-005
- **What was implemented:** Text parser for command interpretation
- **Files changed:** src/engine/Parser.js
- **Learnings:** parse() returns {verb, noun, target, raw, error}, handles USE X WITH Y pattern specially
---

## 2026-01-28 - US-006
- **What was implemented:** GameState manager for game progress tracking
- **Files changed:** src/engine/GameState.js
- **Learnings:** save/load uses localStorage with versioned JSON, supports 3 slots, imports Inventory
---

## 2026-01-28 - US-007
- **What was implemented:** Main Game class tying all engine components together
- **Files changed:** src/engine/Game.js
- **Learnings:** Game takes outputCallback in config, uses Maps for rooms/items, handleCommand returns {success, message}
---

## 2026-01-28 - US-008
- **What was implemented:** GameUI class for browser interface
- **Files changed:** src/ui/GameUI.js, public/game.js
- **Learnings:** GameUI handles DOM binding, game.js imports engine modules, command history with arrow keys
---

## 2026-01-28 - US-009
- **What was implemented:** Cargo Bay 7 starting room with data files
- **Files changed:** src/data/rooms.js, src/data/items.js, public/game.js
- **Learnings:** Room features object for examinable elements, items have startingRoom property, export default for easy import
---

## 2026-01-28 - US-010
- **What was implemented:** TAKE/GET command verification (implemented in US-007)
- **Files changed:** None (verification only)
- **Learnings:** Item.onTake() returns {success, message}, cantTakeMessage for non-takeable items
---

## 2026-01-28 - US-011
- **What was implemented:** EXAMINE command verification
- **Files changed:** None (verification only)
- **Learnings:** handleExamine checks inventory first, then room items, then room features
---

## 2026-01-28 - US-012
- **What was implemented:** First puzzle - mop/shelf/keycard
- **Files changed:** src/data/puzzles.js, public/game.js
- **Learnings:** item.setUseHandler() for custom puzzle logic, initializePuzzles() called after Game creation, score via addScore()
---

## 2026-01-28 - US-013
- **What was implemented:** Corridor rooms verification (implemented in US-009)
- **Files changed:** None (verification only)
- **Learnings:** Main Corridor has 4 exits to hub areas, direction shortcuts (n/s/e/w) work
---

## 2026-01-28 - US-014
- **What was implemented:** Keycard door mechanic
- **Files changed:** src/data/rooms.js, src/data/puzzles.js
- **Learnings:** Locked connections use object {roomId, locked, requiredKey, lockedMessage}, item.setUseHandler can check gameState.getCurrentRoomId()
---

## 2026-01-28 - US-015, US-016
- **What was implemented:** Engineering Deck, Medical Bay, Bridge rooms with items
- **Files changed:** src/data/rooms.js, src/data/items.js
- **Learnings:** Batch similar room implementations together, add items via startingRoom property
---

## 2026-01-28 - US-017
- **What was implemented:** Character class and basic dialogue system
- **Files changed:**
  - src/engine/Character.js - New Character class with dialogue, state, talk(), giveItem(), matchesName()
  - src/data/characters.js - Character data for Dr. Patchwell, Captain Bluster, DUSTY
  - src/engine/Game.js - Added initCharacters() method, Character import, updated handleTalk/handleExamine/handleUse to use matchesName()
  - public/game.js - Import characters data and pass to Game constructor
- **Learnings for future iterations:**
  - Character system follows same pattern as Items: data in src/data/, class in src/engine/, init method in Game
  - Characters placed in rooms via startingRoom property, same as items
  - talk() supports both string and array dialogue (random selection for arrays)
  - Character state (e.g., 'unconscious', 'awake') determines which dialogue is returned
  - matchesName() checks both name.includes() and id exact match for flexible player input
---

## 2026-01-28 - US-018
- **What was implemented:** Smelling salts puzzle to wake Dr. Patchwell
- **Files changed:**
  - src/data/items.js - Added smelling-salts item, updated ammonia useWith array
  - src/data/puzzles.js - Added setupSmellingSaltsPuzzle() function
- **Learnings for future iterations:**
  - Item combination puzzles: set useHandler on first item, check if second item is in inventory
  - Remove consumed items from inventory, add result item directly to inventory
  - Character state updates via game.characters.get(id).setState(newState)
  - Target matching in puzzles uses targetId pattern: target?.id?.toLowerCase() || target?.toLowerCase?.() || ''
  - When USE X WITH Y doesn't work, try using character's last name (e.g., "patchwell" not "doctor")
---

## 2026-01-28 - US-019
- **What was implemented:** Mess Hall room with broken food synthesizer
- **Files changed:**
  - src/data/rooms.js - Added mess-hall room, added UP exit from main-corridor
  - src/data/items.js - Added coffee-mug and stale-donuts items
- **Learnings for future iterations:**
  - Use UP/DOWN connections for multi-level areas (stairs, elevators)
  - Room features can provide puzzle hints (e.g., "needs duct tape" for repair puzzle)
  - Items can be placed in new rooms via startingRoom property without additional code
---

## 2026-01-28 - US-020
- **What was implemented:** Coffee creation and doctor reward puzzle chain
- **Files changed:**
  - src/data/items.js - Added duct-tape, caffeinated-sludge, engineering-keycard items
  - src/data/puzzles.js - Added setupCoffeePuzzle() with repair, make, and give handlers
- **Learnings for future iterations:**
  - Multi-step puzzles can chain: item A enables action B which creates item C for exchange D
  - Room checks prevent puzzle actions in wrong locations (e.g., repair only in mess-hall)
  - Prerequisite checks (e.g., synthesizer_repaired flag) gate puzzle progression
  - Character item exchanges: remove consumed item, add received item, update character state
  - Scoring can be distributed across puzzle steps for better feedback
---

## 2026-01-28 - US-021
- **What was implemented:** Science Lab with alien artifact and goo puzzle
- **Files changed:**
  - src/data/rooms.js - Added science-lab-corridor and science-lab rooms, added DOWN exit from main-corridor
  - src/data/items.js - Added alien-goo-sample item
  - src/data/characters.js - Added alien-artifact character with sarcastic dialogue array
  - src/data/puzzles.js - Added setupScienceLabPuzzle() for goo dissolution
- **Learnings for future iterations:**
  - Locked doors without requiredKey can use locked boolean with lockedMessage for non-keycard puzzles
  - Characters can be inanimate objects (artifact) that respond to TALK TO command
  - Array dialogue provides variety for repeated interactions
  - Environmental obstacles (goo) use same locked door pattern but puzzle-unlocked instead of key-unlocked
---

## 2026-01-28 - US-022
- **What was implemented:** Verification only - Bridge was already implemented in earlier stories
- **Files changed:** None (verification only)
- **Learnings:** Some stories may be completed by earlier work - verify before implementing
---

## 2026-01-28 - US-023
- **What was implemented:** Crew Quarters room with personal effects and power cell
- **Files changed:**
  - src/data/rooms.js - Added crew-quarters room with bidirectional connection to cargo-corridor
  - src/data/items.js - Added power-cell item
- **Learnings for future iterations:**
  - Room features can contain important clues (password in photo)
  - Personal effects add flavor and character to the world
  - Items needed for later puzzles can be placed early for discovery
---

## 2026-01-28 - US-024
- **What was implemented:** Power cell puzzle for restoring emergency power
- **Files changed:**
  - src/data/puzzles.js - Added setupPowerCellPuzzle() function
- **Learnings for future iterations:**
  - Room-specific puzzles check currentRoomId before allowing the action
  - Installed items can be removed from inventory (consumed by puzzle)
  - Room features (like 'power cell slot') guide players on what targets to use
  - Flag-based state (power_restored) can gate future puzzle access
---
